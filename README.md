# ğŸ”® ColossalAI-Platform-CLI

## ğŸ”— Table Of Contents

- [ğŸ”® ColossalAI-Platform-CLI](#-colossalai-platform-cli)
  - [ğŸ”— Table Of Contents](#-table-of-contents)
  - [ğŸ“š æ¦‚è¿°](#-overview)
  - [ğŸ”¨ å®‰è£…](#-installation)
  - [âŒ¨ï¸ åŠŸèƒ½è¯´æ˜](#ï¸-usage)
    - [Create a Template](#create-a-template)

## ğŸ“š æ¦‚è¿°

ColossalAI Platform CLI æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºè®¿é—® ColossalAI äº‘å¹³å°çš„å„ç§åŠŸèƒ½ã€‚CLI å·¥å…·åä¸º `cap`ï¼Œä»£è¡¨ `C(olossal)A(I) P(latform)`ã€‚è¯¥å·¥å…·æ—¨åœ¨ä¸ºç”¨æˆ·æä¾›ä¾¿æ·çš„ç•Œé¢æ¥ä½¿ç”¨äº‘å¹³å°çš„åŠŸèƒ½ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚

è¯¥ CLI å·¥å…·åŸºäº [Click](https://click.palletsprojects.com/en/8.0.x/) æ„å»ºï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºä¼˜é›…çš„å‘½ä»¤è¡Œç•Œé¢çš„ Python åŒ…ã€‚

## ğŸ”¨ å®‰è£…

æœ‰ä¸¤ç§å®‰è£…æ–¹å¼ï¼š

1. ä»æºä»£ç å®‰è£…

```bash
pip install git+https://github.com/hpcaitech/ColossalAI-Platform-CLI@main
```

2. ä» PyPI å®‰è£…

```bash
pip install colossalai-platform
```

## âŒ¨ï¸ åŠŸèƒ½è¯´æ˜

### é…ç½®å’Œç™»å½•

```bash
cap configure
```

ç”¨äºé…ç½®å’Œç™»å½•å¹³å°ã€‚ä¼šæç¤ºè¾“å…¥ï¼š
- ç”¨æˆ·å
- å¯†ç ï¼ˆè¾“å…¥æ—¶éšè—ï¼‰

### é¡¹ç›®ç®¡ç†

é¡¹ç›®ç›¸å…³å‘½ä»¤ç”¨äºç®¡ç†è®­ç»ƒå’Œæ¨ç†é¡¹ç›®ï¼š

```bash
cap project <command>
```

å¯ç”¨çš„å­å‘½ä»¤ï¼š
- `init <project-name>`: åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ ColossalAI é¡¹ç›®æ¨¡æ¿
  - åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„
  - ç”ŸæˆåŸºç¡€æ–‡ä»¶ï¼ˆtrain.shã€train.pyã€HyperParameters.json ç­‰ï¼‰
- `create`: åˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®
  - éœ€è¦è¾“å…¥é¡¹ç›®åç§°å’Œæè¿°
- `list`: åˆ—å‡ºæ‰€æœ‰é¡¹ç›®
- `upload-dir <project-id> <directory>`: ä¸Šä¼ æ•´ä¸ªç›®å½•ä½œä¸ºé¡¹ç›®
  - ä¼šè¦†ç›–å·²æœ‰çš„é¡¹ç›®å†…å®¹
  - æ”¯æŒ `-y` å‚æ•°è·³è¿‡ç¡®è®¤

### æ•°æ®é›†ç®¡ç†

æ•°æ®é›†ç›¸å…³å‘½ä»¤ç”¨äºç®¡ç†è®­ç»ƒæ•°æ®é›†ï¼š

```bash
cap dataset <command>
```

å¯ç”¨çš„å­å‘½ä»¤ï¼š
- `create`: åˆ›å»ºä¸€ä¸ªç©ºæ•°æ®é›†
  - éœ€è¦è¾“å…¥æ•°æ®é›†åç§°å’Œæè¿°
- `list`: åˆ—å‡ºæ‰€æœ‰æ•°æ®é›†
- `upload-dir <dataset-id> <directory>`: ä¸Šä¼ æ•´ä¸ªç›®å½•ä½œä¸ºæ•°æ®é›†
  - ä¼šè¦†ç›–å·²æœ‰çš„æ•°æ®é›†å†…å®¹
  - æ”¯æŒ `-y` å‚æ•°è·³è¿‡ç¡®è®¤

### æ¨¡å‹ç®¡ç†

æ¨¡å‹ç›¸å…³å‘½ä»¤ç”¨äºç®¡ç†æ¨¡å‹ï¼š

```bash
cap model <command>
```

å¯ç”¨çš„å­å‘½ä»¤ï¼š
- `create`: åˆ›å»ºä¸€ä¸ªç©ºæ¨¡å‹
  - éœ€è¦è¾“å…¥æ¨¡å‹åç§°å’Œæè¿°
- `list`: åˆ—å‡ºæ‰€æœ‰æ¨¡å‹
  - æ”¯æŒ `--tag` å‚æ•°æŒ‰æ ‡ç­¾ç­›é€‰
- `upload-dir <model-id> <directory>`: ä¸Šä¼ æ•´ä¸ªç›®å½•ä½œä¸ºæ¨¡å‹
  - ä¼šè¦†ç›–å·²æœ‰çš„æ¨¡å‹å†…å®¹
  - æ”¯æŒ `-y` å‚æ•°è·³è¿‡ç¡®è®¤

### ä½œä¸šç®¡ç†

ä½œä¸šç›¸å…³å‘½ä»¤ç”¨äºç®¡ç†è®­ç»ƒä½œä¸šï¼š

```bash
cap job <command>
```

å¯ç”¨çš„å­å‘½ä»¤ï¼š
- `list`: åˆ—å‡ºæ‰€æœ‰ä½œä¸š
  - æ˜¾ç¤ºä½œä¸šåç§°ã€IDã€çŠ¶æ€ã€æè¿°å’Œåˆ›å»ºæ—¶é—´ç­‰ä¿¡æ¯
- `init-yaml`: åˆå§‹åŒ–ä½œä¸šé…ç½® YAML æ–‡ä»¶
  - å¿…éœ€å‚æ•°ï¼š
    - `--project-id/-p`: é¡¹ç›® IDï¼ˆå¯é€šè¿‡ `cap project list` æŸ¥çœ‹ï¼‰
  - å¯é€‰å‚æ•°ï¼š
    - `--version/-v`: é¡¹ç›®ç‰ˆæœ¬ï¼ˆå½“æœ‰å¤šä¸ªç‰ˆæœ¬æ—¶å¿…é¡»æŒ‡å®šï¼‰
    - `--output-path/-o`: è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ä¸º job.yamlï¼‰
    - `--stdout`: è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºè€Œä¸æ˜¯æ–‡ä»¶
- `submit <job-yaml>`: æäº¤ä½œä¸š
  - æ ¹æ® YAML æ–‡ä»¶æäº¤è®­ç»ƒä½œä¸š
  - æäº¤åä¼šæ˜¾ç¤ºä½œä¸š ID å’Œè¯¦æƒ…é¡µé¢é“¾æ¥

### YAML é…ç½®è¯´æ˜

ä½œä¸šçš„ YAML é…ç½®æ–‡ä»¶åŒ…å«ä»¥ä¸‹ä¸»è¦å­—æ®µï¼š

```yaml
jobName: "job-name"              # ä½œä¸šåç§°
jobDescription: "description"     # ä½œä¸šæè¿°
image: "image:tag"               # è¿è¡Œç¯å¢ƒé•œåƒ
hyperParameters:                  # è¶…å‚æ•°é…ç½®
  param1: value1
  param2: value2
resourceType: "public"           # èµ„æºç±»å‹ï¼špublic æˆ– private
gpu:                            # GPU é…ç½®
  gpuType: "NVIDIA-V100"        # GPU ç±»å‹
  manufacturer: "Nvidia"        # åˆ¶é€ å•†
  number: 1                     # GPU æ•°é‡
mounts:                         # æŒ‚è½½é…ç½®
  - type: "dataset"            # ç±»å‹ï¼šdatasetã€project æˆ– model
    id: "xxx"                  # å¯¹åº”èµ„æºçš„ ID
    version: 1                 # ç‰ˆæœ¬å·
    mountPath: "/mnt/data"     # æŒ‚è½½è·¯å¾„
    name: "resource-name"      # èµ„æºåç§°
    readOnly: true            # æ˜¯å¦åªè¯»
launchCommand: "bash /mnt/project/train.sh"  # å¯åŠ¨å‘½ä»¤
```

## ğŸ”— ç›¸å…³é“¾æ¥

- æ–‡æ¡£ç½‘ç«™ï¼šhttps://docs.platform.luchentech.com/
- æ§åˆ¶å°ï¼šhttps://platform.luchentech.com/console

## ğŸ“ æ³¨æ„äº‹é¡¹

1. åœ¨ä½¿ç”¨ä»»ä½•éœ€è¦ç™»å½•çš„å‘½ä»¤å‰ï¼Œè¯·å…ˆè¿è¡Œ `cap configure` è¿›è¡Œç™»å½•ã€‚
2. ä¸Šä¼ ç›®å½•æ—¶è¯·æ³¨æ„ï¼Œä¼šè¦†ç›–ç›®æ ‡ä½ç½®çš„æ‰€æœ‰å†…å®¹ã€‚
3. åˆ›å»ºé¡¹ç›®æ—¶å»ºè®®ä½¿ç”¨ `cap project init` å‘½ä»¤ï¼Œå®ƒä¼šç”Ÿæˆæ ‡å‡†çš„é¡¹ç›®æ¨¡æ¿ã€‚
4. æäº¤ä½œä¸šå‰ï¼Œè¯·ä»”ç»†æ£€æŸ¥ YAML é…ç½®æ–‡ä»¶ä¸­çš„å„é¡¹å‚æ•°ã€‚
